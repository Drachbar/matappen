<form [formGroup]="recipeForm" (ngSubmit)="createRecipe()" enctype="multipart/form-data">
  <fieldset>
    <legend>Ladda upp bilder</legend>
    <input type="file" (change)="onFileSelect($event)" multiple/>
    @if (previewImages.length) {
      <div>
        <ul>
          @for (item of previewImages; track item) {
            <li>
              <img [src]="item.url" alt="{{ item.file.name }}" />
            </li>
          }
        </ul>
      </div>
    }
  </fieldset>

  <fieldset class="card m-3 p-3 border-0 shadow-sm">
    <legend>Översikt</legend>
    <label for="recipe-name">Namn på recept:</label>
    <input id="recipe-name" [formControl]="nameRecipe">
    <label for="recipe-description">Beskrivning:</label>
    <textarea id="recipe-description" [formControl]="recipeDescription" required></textarea>
  </fieldset>

  <fieldset formArrayName="sections" class="card m-3 p-3 border-0 shadow-sm">
    <legend>Recept</legend>
    @for (ingredientSection of sections.controls; track ingredientSection; let i = $index) {
      <fieldset [formGroupName]="i">
        <legend>Ingrediensgrupp {{ i + 1 }}</legend>
        <label for="section-name-{{ i }}">Namn:</label>
        <input id="section-name-{{ i }}" formControlName="name">
        <fieldset formArrayName="ingredients">
          <legend>Ingredienser</legend>
          @for (ingredient of getIngredients(i).controls; track ingredient; let j = $index) {
            <div [formGroupName]="j">
              <label for="ingredient-name-{{ i }}-{{ j }}">Namn:</label>
              <input id="ingredient-name-{{ i }}-{{ j }}" formControlName="name">

              <label for="ingredient-unit-{{ i }}-{{ j }}">Enhet:</label>
              <input id="ingredient-unit-{{ i }}-{{ j }}" formControlName="unit">

              <label for="ingredient-amount-{{ i }}-{{ j }}">Mängd:</label>
              <input id="ingredient-amount-{{ i }}-{{ j }}" formControlName="amount">

              <button type="button" class="btn btn-primary" (click)="removeIngredient(i, j)">Ta bort ingrediens</button>
              <button type="button" class="btn btn-secondary" (click)="moveIngredientUp(i, j)" [disabled]="j === 0">Flytta upp ingrediens</button>
              <button type="button" class="btn btn-secondary" (click)="moveIngredientDown(i, j)" [disabled]="j === getIngredients(i).length - 1">Flytta ned ingrediens</button>
              <!-- ... existing code ... -->
            </div>
          }
          <button type="button" class="btn btn-primary" (click)="addIngredient(i)">Lägg till ingrediens</button>
        </fieldset>
        <button type="button" class="btn btn-secondary" (click)="moveSectionUp(i)" [disabled]="i === 0">Flytta upp</button>
        <button type="button" class="btn btn-secondary" (click)="moveSectionDown(i)" [disabled]="i === sections.length - 1">Flytta ner</button>
        <button type="button" class="btn btn-primary" (click)="removeSection(i)">Ta bort ingrediensgrupp</button>
  </fieldset>
    }
    <button type="button" class="btn btn-primary" (click)="addSection()">Lägg till ingredientgrupp</button>
  </fieldset>

  <fieldset formArrayName="steps" class="card m-3 p-3 border-0 shadow-sm">
    <legend>Steg</legend>
    @for (step of steps.controls; track step; let i = $index) {
      <div [formGroupName]="i">
        <label for="step-description-{{ i }}">Steg {{ i + 1 }}</label>
        <textarea id="step-description-{{ i }}" formControlName="description" class="w-100"></textarea>
        <button type="button" class="btn btn-primary" (click)="removeStep(i)">Ta bort steg</button>
        <button type="button" class="btn btn-secondary" (click)="moveStepUp(i)" [disabled]="i === 0">Flytta upp</button>
        <button type="button" class="btn btn-secondary" (click)="moveStepDown(i)" [disabled]="i === steps.length - 1">Flytta ner</button>
      </div>
    }
    <button type="button" class="btn btn-primary" (click)="addStep()">Lägg till steg</button>
  </fieldset>

  <button type="submit" class="btn btn-primary">
    <!--          [disabled]="recipeForm.invalid">-->
    Skapa recept
  </button>
</form>
